@using Kore.Plugins.Ecommerce.Simple
@using Kore.Plugins.Ecommerce.Simple.Extensions
@using Kore.Web.ContentManagement
@using Kore.Web.Mvc.KoreUI

@{
    string rtlClass = IsRightToLeft ? "k-rtl" : string.Empty;
}

@Html.Hidden("GridPageSize", SiteSettings.DefaultGridPageSize)

<style type="text/css">
    .modal-dialog {
        width: 80% !important;
    }
</style>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="pull-left">
            <a data-bind="click: category.create" class="btn btn-primary">
                <i class="kore-icon kore-icon-add"></i>
                @T(KoreWebLocalizableStrings.General.Create)
            </a>
        </div>
        <div class="pull-right">
            <div id="toolbar" data-bind="visible: category.showToolbar">
                <div class="btn-group pull-right">
                    <a data-bind="click: category.remove" class="btn btn-danger">@T(KoreWebLocalizableStrings.General.Delete).Text</a>
                    @*<a data-bind="click: category.translate" class="btn btn-primary">@T(KoreCmsLocalizableStrings.Pages.Translations).Text</a>
                    <a data-bind="click: category.toggleEnabled" class="btn btn-default">@T(KoreWebLocalizableStrings.General.Toggle).Text</a>*@
                    <a data-bind="click: category.showProducts" class="btn btn-default">
                        <i class="kore-icon kore-icon-tags"></i>
                        @T(LocalizableStrings.Products)
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="clearfix"></div>
<br />

<div class="row">
    <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3">
        @using (var panel = Html.KoreUI().Begin(new Panel(state: State.Primary)))
        {
            using (var header = panel.BeginHeader(T(LocalizableStrings.Categories))) { }
            using (var body = panel.BeginBody())
            {
                <div class="@rtlClass">
                    <div id="treeview"></div>
                </div>
            }
        }
    </div>
    <div class="col-xs-12 col-sm-8 col-md-8 col-lg-9">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div id="blank-section" class="row" style="display:none">
                    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <div class="alert alert-info">
                            @T(LocalizableStrings.SelectCategoryToBeginEdit)
                        </div>
                    </article>
                </div>

                <div id="form-section" class="row" style="display:none">
                    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        @using (var panel = Html.KoreUI().Begin(new Panel(state: State.Primary)))
                        {
                            using (var header = panel.BeginHeader(T(KoreWebLocalizableStrings.General.Details))) { }
                            using (var body = panel.BeginBody())
                            {
                                <form id="form-section-form" role="form">
                                    <fieldset>
                                        <legend id="form-section-legend"></legend>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("Name", T(LocalizableStrings.CategoryModel.Name), new { @class = "control-label" })
                                                @Html.TextBox("Name", null, new { @class = "form-control", data_bind = "value: category.name" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("Slug", T(LocalizableStrings.CategoryModel.Slug), new { @class = "control-label" })
                                                @Html.TextBox("Slug", null, new { @class = "form-control", data_bind = "value: category.slug" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("Order", T(LocalizableStrings.CategoryModel.Order), new { @class = "control-label" })
                                                <div class="input-group">
                                                    <span class="input-group-addon">
                                                        <i class="kore-icon kore-icon-sort-numeric-asc"></i>
                                                    </span>
                                                    @Html.TextBox("Order", null, new { @class = "form-control", data_bind = "value: category.order" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
                                            <div class="form-group">
                                                <div data-bind="if: category.imageUrl">
                                                    <img data-bind="attr: { src: category.imageUrl }" class="img-responsive img-thumbnail" />
                                                </div>
                                                <div data-bind="ifnot: category.imageUrl">
                                                    <img src="http://placehold.it/320x240&text=Image+Missing" class="img-responsive img-thumbnail" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                                            <div class="form-group">
                                                @Html.Label("ImageUrl", T(LocalizableStrings.CategoryModel.ImageUrl), new { @class = "control-label" })
                                                <div class="input-group">
                                                    @Html.TextBox("ImageUrl", null, new { @class = "form-control", data_bind = "value: category.imageUrl" })
                                                    <span class="input-group-addon">
                                                        <a data-toggle="modal" href="javascript:void(0);" data-target="#categoryImageModal">
                                                            <i class="kore-icon kore-icon-search"></i>
                                                        </a>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("Description", T(LocalizableStrings.CategoryModel.Description), new { @class = "control-label" })
                                                @Html.TextArea("Description", null, new { @class = "form-control", data_bind = "value: category.description" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("MetaKeywords", T(LocalizableStrings.CategoryModel.MetaKeywords), new { @class = "control-label" })
                                                @Html.TextBox("MetaKeywords", null, new { @class = "form-control", data_bind = "value: category.metaKeywords" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("MetaDescription", T(LocalizableStrings.CategoryModel.MetaDescription), new { @class = "control-label" })
                                                @Html.TextBox("MetaDescription", null, new { @class = "form-control", data_bind = "value: category.metaDescription" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group pull-right">
                                                <button type="button" class="btn btn-default" data-bind="click: category.cancel">@T(KoreWebLocalizableStrings.General.Cancel)</button>
                                                <button type="button" class="btn btn-primary" data-bind="click: category.save"><i class="kore-icon kore-icon-save"></i> @T(KoreWebLocalizableStrings.General.Save)</button>
                                            </div>
                                        </div>
                                    </fieldset>
                                </form>
                            }
                        }
                    </article>
                </div>

                <div id="product-grid-section" class="row" style="display:none">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <a data-bind="click: product.create" class="btn btn-primary">
                            <i class="kore-icon kore-icon-add"></i>
                            @T(KoreWebLocalizableStrings.General.Create)
                        </a>
                    </div>

                    <div class="clearfix"></div>
                    <br />

                    <div class="col-md-12 @rtlClass">
                        <div id="ProductGrid"></div>
                    </div>
                </div>

                <div id="product-form-section" class="row" style="display:none">
                    <div data-bind="visible: product.showToolbar">
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                            <a data-bind="attr: { href: '#blocks/entity-type-content-blocks/Ecommerce-Simple-Product/' + product.id() }" class="btn btn-info" title="@T(KoreCmsLocalizableStrings.ContentBlocks.Title).Text">
                                <i class="kore-icon kore-icon-content-blocks"></i> @T(KoreCmsLocalizableStrings.ContentBlocks.Title)
                            </a>
                        </div>

                        <div class="clearfix"></div>
                        <br />
                    </div>
                    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        @using (var panel = Html.KoreUI().Begin(new Panel(state: State.Primary)))
                        {
                            using (var header = panel.BeginHeader(T(LocalizableStrings.Product))) { }
                            using (var body = panel.BeginBody())
                            {
                                <form id="product-form-section-form" role="form">
                                    <fieldset>
                                        <legend id="product-form-section-legend"></legend>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("Name", T(LocalizableStrings.ProductModel.Name), new { @class = "control-label" })
                                                @Html.TextBox("Name", null, new { @class = "form-control", data_bind = "value: product.name" })
                                            </div>
                                        </div>
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                @Html.Label("Slug", T(LocalizableStrings.ProductModel.Slug), new { @class = "control-label" })
                                                @Html.TextBox("Slug", null, new { @class = "form-control", data_bind = "value: product.slug" })
                                            </div>
                                        </div>
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                @Html.Label("Price", T(LocalizableStrings.ProductModel.Price), new { @class = "control-label" })
                                                @Html.TextBox("Price", null, new { @class = "form-control", data_bind = "value: product.price" })
                                            </div>
                                        </div>
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                @Html.Label("Tax", T(LocalizableStrings.ProductModel.Tax), new { @class = "control-label" })
                                                @Html.TextBox("Tax", null, new { @class = "form-control", data_bind = "value: product.tax" })
                                            </div>
                                        </div>
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                @Html.Label("ShippingCost", T(LocalizableStrings.ProductModel.ShippingCost), new { @class = "control-label" })
                                                @Html.TextBox("ShippingCost", null, new { @class = "form-control", data_bind = "value: product.shippingCost" })
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
                                            <div class="form-group">
                                                <div data-bind="if: product.mainImageUrl">
                                                    <img data-bind="attr: { src: product.mainImageUrl }" class="img-responsive img-thumbnail" />
                                                </div>
                                                <div data-bind="ifnot: product.mainImageUrl">
                                                    <img src="http://placehold.it/320x240&text=Image+Missing" class="img-responsive img-thumbnail" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                                            <div class="form-group">
                                                @Html.Label("MainImageUrl", T(LocalizableStrings.ProductModel.MainImageUrl), new { @class = "control-label" })
                                                <div class="input-group">
                                                    @Html.TextBox("MainImageUrl", null, new { @class = "form-control", data_bind = "value: product.mainImageUrl" })
                                                    <span class="input-group-addon">
                                                        <a data-toggle="modal" href="javascript:void(0);" data-target="#productImageModal">
                                                            <i class="kore-icon kore-icon-search"></i>
                                                        </a>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                @Html.Label("ShortDescription", T(LocalizableStrings.ProductModel.ShortDescription), new { @class = "control-label" })
                                                @Html.TextArea("ShortDescription", null, new { @class = "form-control", data_bind = "value: product.shortDescription" })
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group">
                                                <div class="checkbox">
                                                    <label>
                                                        @Html.CheckBox("UseExternalLink", new { data_bind = "checked: product.useExternalLink" }) @T(LocalizableStrings.CategoryModel.UseExternalLink)
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" data-bind="visible: product.useExternalLink() == true">
                                            <div class="form-group">
                                                @Html.Label("ExternalLink", T(LocalizableStrings.CategoryModel.ExternalLink), new { @class = "control-label" })
                                                @Html.TextBox("ExternalLink", null, new { @class = "form-control", data_bind = "value: product.externalLink" })
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" data-bind="visible: product.useExternalLink() == false">
                                            <div class="form-group">
                                                @Html.Label("FullDescription", T(LocalizableStrings.ProductModel.FullDescription), new { @class = "control-label" })
                                                @Html.TextArea("FullDescription", null, new { @class = "form-control", data_bind = "wysiwyg: product.fullDescription, wysiwygConfig: product.tinyMCE_fullDescription" })
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" data-bind="visible: product.useExternalLink() == false">
                                            <div class="form-group">
                                                @Html.Label("MetaKeywords", T(LocalizableStrings.ProductModel.MetaKeywords), new { @class = "control-label" })
                                                @Html.TextBox("MetaKeywords", null, new { @class = "form-control", data_bind = "value: product.metaKeywords" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" data-bind="visible: product.useExternalLink() == false">
                                            <div class="form-group">
                                                @Html.Label("MetaDescription", T(LocalizableStrings.ProductModel.MetaDescription), new { @class = "control-label" })
                                                @Html.TextBox("MetaDescription", null, new { @class = "form-control", data_bind = "value: product.metaDescription" })
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="form-group pull-right">
                                                <button type="button" class="btn btn-default" data-bind="click: product.cancel">@T(KoreWebLocalizableStrings.General.Cancel)</button>
                                                <button type="button" class="btn btn-primary" data-bind="click: product.save"><i class="kore-icon kore-icon-save"></i> @T(KoreWebLocalizableStrings.General.Save)</button>
                                            </div>
                                        </div>
                                    </fieldset>
                                </form>
                            }
                        }
                    </article>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="categoryImageModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-bind="click: dismissModal.bind($data,'categoryImageModal')" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Select Image</h4>
            </div>
            <div class="modal-body">
                <iframe src="/filemanager/dialog.php?type=1&relative_url=1&fldr=&field_id=ImageUrl&ignore_last_position=1" frameborder="0" style="overflow:hidden;min-height:600px; height:100%;width:100%" height="100%" width="100%"></iframe>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="productImageModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-bind="click: dismissModal.bind($data,'productImageModal')" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Select Image</h4>
            </div>
            <div class="modal-body">
                <iframe src="/filemanager/dialog.php?type=1&relative_url=1&fldr=&field_id=MainImageUrl&ignore_last_position=1" frameborder="0" style="overflow:hidden;min-height:600px; height:100%;width:100%" height="100%" width="100%"></iframe>
            </div>
        </div>
    </div>
</div>

<script id="treeview-template" type="text/kendo-ui-template">
    <a href="javascript:void(0)" data-bind="click: category.edit.bind($data,'#=item.Id#')">#= item.Name #</a>
</script>