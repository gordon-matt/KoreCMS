@using Kore.Infrastructure
@using Kore.Web.ContentManagement.Areas.Admin.Localization
@using Kore.Localization.Services
@model LanguageSwitchBlock

@if (Model.Style == LanguageSwitchBlock.LanguageSwitchStyle.Custom)
{
    @Html.Partial(Model.CustomTemplatePath, Model)
    return;
}

@{
    var languages = EngineContext.Current.Resolve<ILanguageService>().GetActiveLanguages();
}

@switch (Model.Style)
{
    case LanguageSwitchBlock.LanguageSwitchStyle.BootstrapNavbarDropdown:
        {
            <li class="dropdown">
                <a aria-expanded="true" role="button" data-toggle="dropdown" class="dropdown-toggle" href="#">
                    Language
                    <span class="caret"></span>
                </a>
                <ul role="menu" class="dropdown-menu">
                    @if (Model.UseUrlPrefix)
                    {
                        foreach (var language in languages)
                        {
                            <li>
                                <a href="/@language.UniqueSeoCode">
                                    @if (language.CultureCode == WorkContext.CurrentCultureCode)
                                    {
                                        <span class="kore-icon kore-icon-ok"></span>
                                    }
                                    @language.Name
                                </a>
                            </li>
                        }
                    }
                    else
                    {
                        foreach (var language in languages)
                        {
                            <li>
                                <a href="#" onclick="changeLanguage('@language.CultureCode');">
                                    @if (language.CultureCode == WorkContext.CurrentCultureCode)
                                    {
                                        <span class="kore-icon kore-icon-ok"></span>
                                    }
                                    @language.Name
                                </a>
                            </li>
                        }
                    }
                </ul>
            </li>
        }
        break;

    case LanguageSwitchBlock.LanguageSwitchStyle.Select:
        {
            <select onchange="changeLanguage(this.value);" autocomplete="off" class="form-control">
                @foreach (var language in languages)
                {
                    string languageCode = Model.UseUrlPrefix
                        ? language.UniqueSeoCode
                        : language.CultureCode;
                        
                    if (language.CultureCode == WorkContext.CurrentCultureCode)
                    {
                        <option value="@languageCode" selected="selected">@language.Name</option>
                    }
                    else
                    {
                        <option value="@languageCode">@language.Name</option>
                    }
                }
            </select>
        }
        break;
    case LanguageSwitchBlock.LanguageSwitchStyle.List:
        <ul>
            @foreach (var language in languages)
            {
                <li class="@language.CultureCode">
                    @if (Model.UseUrlPrefix)
                    {
                        <a href="/@language.UniqueSeoCode">@language.Name</a>
                    }
                    else
                    {
                        <a href="javascript:void(0)" onclick="changeLanguage('@language.CultureCode');">@language.Name</a>
                    }
                </li>
            }
        </ul>
        break;
}

<script type="text/javascript">
    @if (Model.UseUrlPrefix)
    {
        <text>
        function changeLanguage(uniqueSeoCode) {
            window.location = uniqueSeoCode;
        }
        </text>
    }
    else
    {
        <text>
        function changeLanguage(cultureCode) {
            document.cookie = 'CurrentCulture=' + cultureCode + '; path=/';
            window.location.reload();
        }
        </text>
    }
</script>