@using Kore.Infrastructure
@using Kore.Plugins.Ecommerce.Simple
@using Kore.Plugins.Ecommerce.Simple.Data.Domain
@model IEnumerable<Category>

@{
    Layout = KoreWebConstants.DefaultFrontendLayoutPath;

    Script.IncludeBundle("kore-cms/bootpag");

    var settings = EngineContext.Current.Resolve<StoreSettings>();
    ViewBag.Title = settings.PageTitle;

    int pageCount = ViewBag.PageCount;
    int pageIndex = ViewBag.PageIndex;

    int index = 1;
    int loopCount = 1;
}

<div class="categories-container">
    @foreach (var entry in Model)
    {
        if (loopCount == 1)
        {
            @Html.Raw(@"<div class=""row"">")
        }

        string imageUrl = string.IsNullOrEmpty(entry.ImageUrl)
            ? "http://placehold.it/280x136&text=Image+Missing"
            : entry.ImageUrl;

        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div class="thumbnail">
                <img src="@imageUrl" alt="@entry.Name" />
                <div class="caption">
                    <h3>@Html.ActionLink(entry.Name, "Products", "Store", new { area = string.Empty, categorySlug = entry.Slug }, null)</h3>
                    <p>@entry.Description.Left(128)</p>
                </div>
            </div>
        </div>

        if (loopCount == 3 || index == (Model.Count()))
        {
            @Html.Raw("</div>")
            <div class="clearfix"></div>
            loopCount = 1;
            index++;
            continue;
        }

        index++;
        loopCount++;
    }
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div id="pager"></div>
    </div>
</div>

@using (Script.AtFoot())
{
    <script type="text/javascript">
        $('#pager').bootpag({
            total: @pageCount,
            page: @pageIndex,
            maxVisible: 5,
            leaps: true,
            firstLastUse: true,
        }).on("page", function (event, num) {
            window.location.href = '@Url.Action("Categories", "Store", new { area = string.Empty })' + '?pageIndex=' + num;
        });
    </script>
}