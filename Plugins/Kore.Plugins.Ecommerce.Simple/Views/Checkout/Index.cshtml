@using Kore.Plugins.Ecommerce.Simple
@using Kore.Plugins.Ecommerce.Simple.Extensions
@using Kore.Plugins.Ecommerce.Simple.Models
@using Kore.Web.Common
@using Kore.Web.Mvc.KoreUI

@using LocalizableStrings = Kore.Plugins.Ecommerce.Simple.LocalizableStrings
@model CheckoutModel

@{
    Script.IncludeBundle("jqueryval");
    string currencyCode = ViewBag.CurrencyCode;
}

@using (Html.BeginForm("Confirm", "Checkout", new { area = string.Empty }, FormMethod.Post, new { id = "checkout-form" }))
{
    <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">@T(LocalizableStrings.BillingAddress)</h3>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="checkbox">
                            @*This form-group is here just to make these fields below align nicely with the same fields for shipping address*@
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.GivenNames, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-user"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.GivenNames, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.GivenNames)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.FamilyName, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-user"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.FamilyName, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.FamilyName)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.Email, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-mail"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.Email, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.Email)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.AddressLine1, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.AddressLine1, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.AddressLine1)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.AddressLine2, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.AddressLine2, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.AddressLine2)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.AddressLine3, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.AddressLine3, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.AddressLine3)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.City, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.City, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.City)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.PostalCode, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.PostalCode, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.PostalCode)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.CountryId, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-globe"></i></span>
                            @Html.KoreCommon().CountryDropDownListFor(m => m.BillingAddress.CountryId, htmlAttributes: new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.CountryId)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.BillingAddress.PhoneNumber, new { @class = "control-label" })
                        <div class="input-group">
                            <span class="input-group-addon"><i class="kore-icon kore-icon-phone"></i></span>
                            @Html.TextBoxFor(m => m.BillingAddress.PhoneNumber, new { @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.BillingAddress.PhoneNumber)
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">@T(LocalizableStrings.ShippingAddress)</h3>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                @Html.CheckBoxFor(m => m.ShippingAddressIsSameAsBillingAddress, new { onclick = "toggleShippingAddressSection();" }) @T(LocalizableStrings.ShippingAddressSameAsBillingAddress)
                            </label>
                        </div>
                    </div>
                    <div id="shipping-address">
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.GivenNames, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-user"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.GivenNames, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.GivenNames)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.FamilyName, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-user"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.FamilyName, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.FamilyName)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.Email, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-mail"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.Email, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.Email)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.AddressLine1, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.AddressLine1, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.AddressLine1)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.AddressLine2, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.AddressLine2, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.AddressLine2)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.AddressLine3, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.AddressLine3, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.AddressLine3)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.City, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.City, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.City)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.PostalCode, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-road"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.PostalCode, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.PostalCode)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.CountryId, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-globe"></i></span>
                                @Html.KoreCommon().CountryDropDownListFor(m => m.ShippingAddress.CountryId, htmlAttributes: new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.CountryId)
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ShippingAddress.PhoneNumber, new { @class = "control-label" })
                            <div class="input-group">
                                <span class="input-group-addon"><i class="kore-icon kore-icon-phone"></i></span>
                                @Html.TextBoxFor(m => m.ShippingAddress.PhoneNumber, new { @class = "form-control" })
                            </div>
                            @Html.ValidationMessageFor(m => m.ShippingAddress.PhoneNumber)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">@T(LocalizableStrings.ShoppingCart)</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th></th>
                                <th>@T(LocalizableStrings.CheckoutTable.Product)</th>
                                <th>@T(LocalizableStrings.CheckoutTable.Price)</th>
                                <th>@T(LocalizableStrings.CheckoutTable.Quantity)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Cart.Items)
                            {
                                <tr>
                                    <td><img class="img-responsive" src="@item.ImageUrl" style="max-height:180px" /></td>
                                    <td>@item.ProductName</td>
                                    <td>@currencyCode @item.Price.ToString("N2")</td>
                                    <td>@item.Quantity</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div class="pull-right">
                        <button type="submit" class="btn btn-success">
                            <i class="kore-icon kore-icon-ok"></i>
                            @T(KoreWebLocalizableStrings.General.Confirm)
                        </button>
                    </div>
                </div>
            </div>
        </article>
    </div>
}

@using (Script.AtFoot())
{
    <script type="text/javascript">
        $(document).ready(function () {
            var checkbox = $('#ShippingAddressIsSameAsBillingAddress');
            toggleShippingAddressSection(checkbox);

            //$("#checkout-form").submit(function (event) {
            //    if ($('#ShippingAddressIsSameAsBillingAddress').checked) {
            //        $('#BillingAddress_GivenNames').val($('#ShippingAddress_GivenNames').val());
            //        $('#BillingAddress_FamilyName').val($('#ShippingAddress_FamilyName').val());
            //        $('#BillingAddress_Email').val($('#ShippingAddress_Email').val());
            //        $('#BillingAddress_AddressLine1').val($('#ShippingAddress_AddressLine1').val());
            //        $('#BillingAddress_AddressLine2').val($('#ShippingAddress_AddressLine2').val());
            //        $('#BillingAddress_AddressLine3').val($('#ShippingAddress_AddressLine3').val());
            //        $('#BillingAddress_City').val($('#ShippingAddress_City').val());
            //        $('#BillingAddress_PostalCode').val($('#ShippingAddress_PostalCode').val());
            //        $('#BillingAddress_CountryId').val($('#ShippingAddress_CountryId').val());
            //        $('#BillingAddress_PhoneNumber').val($('#ShippingAddress_PhoneNumber').val());
            //    }
            //});

            $("#checkout-form").validate({
                rules: {
                    BillingAddress_GivenNames: { required: true, maxlength: 128 },
                    BillingAddress_FamilyName: { required: true, maxlength: 128 },
                    BillingAddress_Email: { required: true, maxlength: 255 },
                    BillingAddress_AddressLine1: { required: true, maxlength: 128 },
                    BillingAddress_AddressLine2: { maxlength: 128 },
                    BillingAddress_AddressLine3: { maxlength: 128 },
                    BillingAddress_City: { required: true, maxlength: 128 },
                    BillingAddress_PostalCode: { required: true, maxlength: 10 },
                    BillingAddress_CountryId: { required: true },
                    BillingAddress_PhoneNumber: { required: true, maxlength: 25 },

                    ShippingAddress_GivenNames: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 128 },
                    ShippingAddress_FamilyName: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 128 },
                    ShippingAddress_Email: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 255 },
                    ShippingAddress_AddressLine1: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 128 },
                    ShippingAddress_AddressLine2: { maxlength: 128 },
                    ShippingAddress_AddressLine3: { maxlength: 128 },
                    ShippingAddress_City: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 128 },
                    ShippingAddress_PostalCode: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 10 },
                    ShippingAddress_CountryId: { required: checkIfShippingAddressSameAsBillingAddress() },
                    ShippingAddress_PhoneNumber: { required: checkIfShippingAddressSameAsBillingAddress(), maxlength: 25 }
                }
            });
        });

        function toggleShippingAddressSection() {
            if (checkIfShippingAddressSameAsBillingAddress()) {
                $('#shipping-address').hide();
            }
            else {
                $('#shipping-address').show();
            }
        };

        function checkIfShippingAddressSameAsBillingAddress() {
            return $("#ShippingAddressIsSameAsBillingAddress").is(":checked");
        };
    </script>
}