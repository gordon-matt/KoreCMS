@model KoreCMS.Models.Pages.TestPage

<div id="fields-content" class="col-sm-12 col-md-12">
    <div class="form-group">
        @Html.Label("TestProperty", "Test Property", new { @class = "control-label" })
        @Html.TextBox("TestProperty", null, new { @class = "form-control", data_bind = "value: testProperty" })
    </div>
</div>

<script type="text/javascript">
    var widgetModel = (function () {
        var f = {};
        f.updateModel = function () {
            viewModel.testProperty = ko.observable("");

            var data = ko.mapping.fromJSON(viewModel.fields());

            if (data && data.TestProperty) {
                viewModel.testProperty(data.TestProperty());
            }
        };
        f.cleanUp = function () {
            delete viewModel.testProperty;
        };
        f.onBeforeSave = function () {
            var data = {
                TestProperty: viewModel.testProperty()
            };

            viewModel.fields(ko.mapping.toJSON(data));
        };
        return f;
    })();
</script>